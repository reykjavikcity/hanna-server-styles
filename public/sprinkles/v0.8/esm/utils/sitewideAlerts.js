import{C as S,h as M,p as h,a as v}from"../../_chunks/compat.module-6d0944a1.js";import{S as f,q as p,b as y,M as B,D}from"../../_chunks/qj-b9335549.js";import{A as N}from"../../_chunks/Alert-4d7d517c.js";import{e as U}from"../../_chunks/ensureCSS-ab97bbe2.js";import{g as A}from"../../_chunks/getLang-a66f2b15.js";import{o as u}from"../../_chunks/jsxRuntime.module-98db1a52.js";import"../../_chunks/i18n-45294c51.js";import"../../_chunks/_Button-3fca7562.js";import"../../_chunks/_Link-7f48f5da.js";import"../../_chunks/env-dad6c8ea.js";import"../../_chunks/_useMobileMenuToggling-5fde4833.js";import"../../_chunks/getSVGtext-bab5132d.js";import"../../_chunks/assets-7a061d68.js";const g="alert-dismissed-",E=14*D,O=()=>{if(Math.random()>.1)return;const e=Math.floor((Date.now()-E)/f);for(let r=0;r<localStorage.length;r++){const t=localStorage.key(r);t&&t.startsWith(g)&&Number(localStorage.getItem(t))<e&&localStorage.removeItem(t)}},T=e=>r=>{const t=r.showOnPages||[];if(t.length===0)return!0;const o=r.negateShowOnPages??!0;let s=!1;const a=window.location.pathname;for(let c=0;c<t.length;c++){const m=e.slice(0,-1)+t[c];if(m.charAt(m.length-1)==="*"){if(a.startsWith(m.substring(0,m.length-1))){s=!0;break}}else if(m===a){s=!0;break}}return o?!s:s},_=e=>!(e.dismissible&&(Number(localStorage.getItem(g+e.uuid))||-1)>=(e.dismissalIgnoreBefore||0)),k=(e,r)=>fetch(e).then(t=>t.json()).then(t=>{const o=t.sitewideAlerts,s=Math.ceil(Date.now()/f);return o.forEach(a=>{a.dismissible?(a.dismissalIgnoreBefore||0)>s&&(a.dismissible=!1):delete a.dismissalIgnoreBefore}),o.filter(_).filter(T(r))}).catch(t=>(console.error("Site wide alerts failed loading",t),[])),C=e=>{const r=Math.ceil(Date.now()/f);let t=!1;const o=e.map(s=>s.dismissible||s.dismissalIgnoreBefore||0>r?s:(t=!0,{...s,dismissible:!0}));return t?o:e},x=e=>{const r=Math.floor(Date.now()/f),t=e.filter(o=>(o.dismissalIgnoreBefore||-1)>r).reduce((o,{dismissalIgnoreBefore:s=0})=>o?Math.min(o,s):s,0)-r;return t>0?t:null},L={"alert-warning":"critical","alert-attention":"warning","alert-success":"success","alert-info":"info"},P=e=>{const{alertsUri:r,baseUrl:t="/",lang:o,refreshInterval:s}=e,[a,c]=M([]);h(()=>{const n=()=>{k(r,t).then(l=>{c(d=>d.length!==l.length||JSON.stringify(d)!==JSON.stringify(l)?l:d)})};n();const i=setInterval(n,s);return()=>{clearInterval(i)}},[r,t,s]),h(()=>{const n=x(a)||0;if(n>0){const i=setTimeout(()=>{c(C)},(n+2)*f);return()=>{clearTimeout(i)}}},[a]);const m=({uuid:n})=>{window.localStorage.setItem(g+n,String(Math.round(Date.now()/f))),setTimeout(()=>{c(i=>{const l=i.filter(d=>d.uuid!==n);return l.length<i.length?l:i})},2e3)};return u(v,{children:a.map(n=>{const{uuid:i,styleClass:l,renderedAlert:d=n.message,dismissible:w}=n,I=L[l]||"info";return u(N,{type:I,childrenHTML:d,onClose:w?()=>m(n):void 0,lang:o},i)})})},b=e=>{const r=document.createElement("div");return e.append(r),r},W=(e,r)=>{if(typeof e=="string"){const s=p(e);if(s)return s}else if(e)return e;const t=p(`.${r}__alerts`);if(t)return b(t);const o=document.createElement("div");return o.className=`${r}__alerts`,y(`.${r}, body`).slice(-1)[0].prepend(o),b(o)},$=10*f,q=2*B,J=e=>{O();const r=e.layoutName||"Layout",t=W(e.rootElm,r);U("Alert").then(()=>{const o=Math.max(e.refreshInterval||q,$);S.render(u(P,{alertsUri:e.alertsUri,baseUrl:e.baseUrl,refreshInterval:o,lang:A()}),t)})};export{J as default};
