import"../../initHannaNamespace.js";import{a as x,h as M,T as N,p as R,y as $,k as Y,_ as P,F as A,C as ee}from"../../../_chunks/compat.module-edfc5ce4.js";import{m as te,p as O,r as re,i as ne,n as ie}from"../../../_chunks/qj-f5658347.js";import{b as F,e as se,c as oe,p as ae}from"../../../_chunks/utils-ed8ff0d8.js";import{I as le}from"../../../_chunks/_Image-2ef154d2.js";import{L as ue}from"../../../_chunks/_Link-389e75bd.js";import{o as c}from"../../../_chunks/jsxRuntime.module-53ce29b9.js";import{u as ce}from"../../../_chunks/useFormatMonitor-6ee15356.js";import{A as de}from"../../../_chunks/Alert-72c34951.js";import{T as he}from"../../../_chunks/Tabs-d5dfd9c6.js";import{S as pe}from"../../../_chunks/SiteSearchInput-55e1d438.js";import{searchResultsPageQuery as me,postQuery as fe}from"./reykjavik.is.js";import"../focus-visible.js";import"../../../_chunks/_Button-b5040285.js";import"../../../_chunks/env-971c3e3e.js";function z(){return z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},z.apply(this,arguments)}function ge(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,C(e,t)}function C(e,t){return C=Object.setPrototypeOf||function(i,n){return i.__proto__=n,i},C(e,t)}function ve(e,t){if(e==null)return{};var i={},n=Object.keys(e),r,s;for(s=0;s<n.length;s++)r=n[s],!(t.indexOf(r)>=0)&&(i[r]=e[r]);return i}var E=new Map,H=new WeakMap,U=0,ye=void 0;function be(e){return e?(H.has(e)||(U+=1,H.set(e,U.toString())),H.get(e)):"0"}function we(e){return Object.keys(e).sort().filter(function(t){return e[t]!==void 0}).map(function(t){return t+"_"+(t==="root"?be(e.root):e[t])}).toString()}function Se(e){var t=we(e),i=E.get(t);if(!i){var n=new Map,r,s=new IntersectionObserver(function(o){o.forEach(function(a){var l,u=a.isIntersecting&&r.some(function(d){return a.intersectionRatio>=d});e.trackVisibility&&typeof a.isVisible>"u"&&(a.isVisible=u),(l=n.get(a.target))==null||l.forEach(function(d){d(u,a)})})},e);r=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:s,elements:n},E.set(t,i)}return i}function B(e,t,i,n){if(i===void 0&&(i={}),n===void 0&&(n=ye),typeof window.IntersectionObserver>"u"&&n!==void 0){var r=e.getBoundingClientRect();return t(n,{isIntersecting:n,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:r,intersectionRect:r,rootBounds:r}),function(){}}var s=Se(i),o=s.id,a=s.observer,l=s.elements,u=l.get(e)||[];return l.has(e)||l.set(e,u),u.push(t),a.observe(e),function(){u.splice(u.indexOf(t),1),u.length===0&&(l.delete(e),a.unobserve(e)),l.size===0&&(a.disconnect(),E.delete(o))}}var _e=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function Q(e){return typeof e.children!="function"}var W=function(e){ge(t,e);function t(n){var r;return r=e.call(this,n)||this,r.node=null,r._unobserveCb=null,r.handleNode=function(s){r.node&&(r.unobserve(),!s&&!r.props.triggerOnce&&!r.props.skip&&r.setState({inView:!!r.props.initialInView,entry:void 0})),r.node=s||null,r.observeNode()},r.handleChange=function(s,o){s&&r.props.triggerOnce&&r.unobserve(),Q(r.props)||r.setState({inView:s,entry:o}),r.props.onChange&&r.props.onChange(s,o)},r.state={inView:!!n.initialInView,entry:void 0},r}var i=t.prototype;return i.componentDidUpdate=function(n){(n.rootMargin!==this.props.rootMargin||n.root!==this.props.root||n.threshold!==this.props.threshold||n.skip!==this.props.skip||n.trackVisibility!==this.props.trackVisibility||n.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},i.componentWillUnmount=function(){this.unobserve(),this.node=null},i.observeNode=function(){if(!(!this.node||this.props.skip)){var n=this.props,r=n.threshold,s=n.root,o=n.rootMargin,a=n.trackVisibility,l=n.delay,u=n.fallbackInView;this._unobserveCb=B(this.node,this.handleChange,{threshold:r,root:s,rootMargin:o,trackVisibility:a,delay:l},u)}},i.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},i.render=function(){if(!Q(this.props)){var n=this.state,r=n.inView,s=n.entry;return this.props.children({inView:r,entry:s,ref:this.handleNode})}var o=this.props,a=o.children,l=o.as,u=ve(o,_e);return $(l||"div",z({ref:this.handleNode},u),a)},t}(Y);W.displayName="InView",W.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function ke(e){var t=e===void 0?{}:e,i=t.threshold,n=t.delay,r=t.trackVisibility,s=t.rootMargin,o=t.root,a=t.triggerOnce,l=t.skip,u=t.initialInView,d=t.fallbackInView,h=x(),p=M({inView:!!u}),g=p[0],_=p[1],y=N(function(b){h.current!==void 0&&(h.current(),h.current=void 0),!l&&b&&(h.current=B(b,function(I,v){_({inView:I,entry:v}),v.isIntersecting&&a&&h.current&&(h.current(),h.current=void 0)},{root:o,rootMargin:s,threshold:i,trackVisibility:r,delay:n},d))},[Array.isArray(i)?i.toString():i,o,s,a,l,r,d,n]);R(function(){!h.current&&g.entry&&!a&&!l&&_({inView:!!u})});var m=[y,g.inView,g.entry];return m.ref=m[0],m.inView=m[1],m.entry=m[2],m}const D=e=>{const{highlight:t,title:i,summary:n,href:r,meta:s,image:o}=e,a=t?"SearchResultsHighlightItem":"SearchResultsItem",l=Array.isArray(s)?s:[s];return c("li",{className:a,children:c(ue,{className:a+"__link",href:r,children:[c("h3",{className:a+"__title",children:i}),l.length>0&&c("span",{className:a+"__meta",children:l.map((u,d)=>typeof u=="function"?u():u&&c("span",{children:u},d))}),t&&o&&c(le,{bem:a+"__image",src:o}),c("div",{className:a+"__summary",dangerouslySetInnerHTML:{__html:n}})]})})},Ie=()=>c(P,{children:["\xDAps, \xFEa\xF0 hefur komi\xF0 upp villa. M\xE1 bj\xF3\xF0a \xFE\xE9r a\xF0 pr\xF3fa aftur a\xF0 leita?",c("br",{}),"Ef ekkert l\xE1t er \xE1 villunni \xFE\xE1 kunnum vi\xF0 a\xF0 meta a\xF0 \xFE\xFA l\xE1tir okkur vita."]}),Ve={en:{lang:"en",loadQueryTitle:"Loading results...",resultsTitle:"results found for",noResultsTitle:"No results were found for",loadMore:"Load more"},is:{lang:"is",loadQueryTitle:"S\xE6ki ni\xF0urst\xF6\xF0ur...",resultsTitle:"leitarni\xF0urst\xF6\xF0ur fyrir",noResultsTitle:"Engar leitarni\xF0urst\xF6\xF0ur fundust fyrir",loadMore:"S\xE6kja fleiri"},pl:{lang:"pl",loadQueryTitle:"\u0141adowanie wynik\xF3w...",resultsTitle:"wyniki wyszukiwania dla",noResultsTitle:"Nie znaleziono wynik\xF3w dla",loadMore:"Za\u0142aduj wi\u0119cej"}},Me=e=>{const{domid:t,filters:i,activeIdx:n,setFilter:r,lang:s}=e,o=A(()=>(i||[]).map(({label:a,count:l})=>({label:a,badge:O(l,{lang:s})})),[i,s]);return o.length?c(he,{role:"tablist","aria-controls":t,tabs:o,activeIdx:n||0,onSetActive:a=>r&&r(a)}):null},Z=e=>e.count?c("ol",{className:"SearchResults__list SearchResults__list--loading",children:re(1,e.count).map((t,i)=>c(D,{title:"...",summary:"",href:""},i))}):null,Re=2,qe=e=>{const{status:t,hits:i,numItems:n,loadMore:r,pageSize:s,texts:o}=e,{lang:a}=o,l=(i||0)-(n||0),u=x(0),d=!r||u.current>=Re,[h,p]=ke({rootMargin:"150px 0px 0px 0px",skip:d});return R(()=>{p&&r&&(u.current=u.current+1,r())},[p,r]),t==="loadingmore"?c(Z,{count:Math.min(s,l)}):t==="results"&&l&&r?c("button",{ref:h,className:"SearchResults__loadmore",type:"button",onClick:r,children:[o.loadMore," ",c("span",{className:"SearchResults__loadmore__count",children:["(",O(l,{lang:a}),")"]})]}):null},xe=(e,t)=>{const{status:i,totalHits:n,query:r}=e;return c("h2",{className:"SearchResults__title",children:[i==="loadingquery"?t.loadQueryTitle:n?O(n,{lang:t.lang})+" "+t.resultsTitle:t.noResultsTitle,c("span",{className:"SearchResults__query",children:r})]})},Ne=e=>{const{status:t,pageSize:i,items:n,hits:r}=e;return t==="loadingquery"||t==="loadingfilter"?c(Z,{count:Math.min(i,r||999)}):n&&n.length?c("ol",{className:"SearchResults__list",children:n.map((s,o)=>c(D,{...s},o))}):null},Te=(e,t)=>{const{hits:i,items:n,status:r,pageSize:s,loadMore:o}=e;return c(qe,{hits:i,numItems:n&&n.length,status:r,pageSize:s,loadMore:o,texts:t})},Le=e=>{const{filters:t,activeFilterIdx:i,setFilter:n,status:r,errorText:s,wrapperProps:o}=e,a=F(e,Ve),l=ce();return c("div",{...o,className:te("SearchResults",r!=="results"&&r,(o||{}).className),children:[xe(e,a),c(Me,{domid:l,filters:t,activeIdx:i,setFilter:n,lang:a.lang}),c("div",{className:"SearchResults__results",id:l,children:[Ne(e),r==="error"&&c(de,{type:"error",children:s||Ie()}),Te(e,a)]})]})},T=(...e)=>console.error("renderSiteSearchPage: ",...e),L=document.createElement("div"),Oe=(e,t)=>(e=e.trim(),e.indexOf(t)===0?e.slice(t.length).trim():e),ze=(e,t)=>e?(L.innerHTML=e,L.textContent=Oe(L.textContent,t),L.innerHTML):"",G=e=>e&&e[0]!=null?e[0].value:"",Ce=(e,t)=>e.map(i=>{const{label:n,url_alias:r,url_internal:s,field_date:o,field_summary:a,rendered_search_result:l}=i,u=[],d=G(o);return d&&u.push(ae(d,t)),{title:n,meta:u.length?u:void 0,summary:G(a)||ze(l,n),href:r||s}}),Ee=(e,t)=>{const{aggregateData:i={},totalHits:n}=t||{};return e.map(({name:r,label:s})=>({name:r,label:s,count:(r?i[r]:n)||0})).filter(r=>r.count>0)},He=e=>Object.entries({"":"Allt",...e}).map(([t,i])=>({name:t||"",label:i})),je=10,J=2,Pe={en:{searchInputLabel:"Enter your search query",searchPlaceholder:"Enter your search query",searchButtonText:"Search"},is:{searchInputLabel:"Sl\xE1\xF0u inn leitaror\xF0",searchPlaceholder:"Sl\xE1\xF0u inn leitaror\xF0",searchButtonText:"Leita"},pl:{searchInputLabel:"Wpisz wyszukiwane s\u0142owa",searchPlaceholder:"Wpisz wyszukiwane s\u0142owa",searchButtonText:"Szukaj"}},j={push:(e,t)=>{const i=t?"replaceState":"pushState",n=ie(e),r=n?"?"+n:"";history[i](null,"",r),window.dispatchEvent(new Event("minirouting"))},replace:e=>j.push(e,!0)},K=(e={})=>{const t=new URLSearchParams(window.location.search),i=t.get("q")||void 0,n=t.get("type")||void 0;return i!==e.q||n!==e.type?{q:i,type:n}:e},Ae=(e,t,i,n)=>{const r=A(()=>He(t),[t]),[s,o]=M(K),a=x({}),l=N(()=>{o(y=>(a.current=y,K(y)))},[]),[,u]=M(0);R(()=>(window.addEventListener("popstate",l),window.addEventListener("minirouting",l),()=>{window.removeEventListener("popstate",l),window.removeEventListener("minirouting",l)}),[l]);const[d,h]=M({items:[]}),p=x(),g=N((y=0)=>{const{q:m,type:b}=s,I=a.current,v=m!==I.q?"loadingquery":b!==I.type?"loadingfilter":y>0?"loadingmore":void 0;if(!v||!m||m.length<J)return;h(w=>{var S,V;return{status:v,totalHits:v==="loadingquery"?void 0:w.totalHits,hits:v==="loadingquery"||(V=(S=w.filters)==null?void 0:S.find(q=>q.name===b))==null?void 0:V.count,items:v==="loadingmore"?w.items:[],filters:v==="loadingquery"?r.slice(0,1):w.filters}});const f=new AbortController,k=me({value:m,filter:b&&r.find(w=>w.name===b)?[{term:{bundle:b}}]:void 0,from:y*i,size:i});return fe(e,k,f.signal).then(w=>{const[S,V]=w;if(!S||!V)throw new Error("query returned incomplete results");const q=Ce(V.items,n);h(X=>({status:"results",totalHits:S.totalHits,hits:b?V.totalHits:S.totalHits,items:v==="loadingmore"?X.items.concat(q):q,filters:Ee(r,S)})),l(),p.current=void 0}).catch(w=>{f.signal.aborted||(p.current=void 0,T(w),h(S=>({...S,status:"error"})))}),()=>f.abort()},[s,r,i,e,l,n]);R(()=>(u(0),p.current&&p.current(),p.current=g(),()=>{p.current&&p.current()}),[g]);const _=N(()=>{p.current||u(y=>{const m=y+1;return p.current=g(m),m})},[g]);return{params:s,searchResults:d,loadMore:_}},Fe=()=>{const[e]=M(()=>ne.d(500));return R(()=>e.cancel,[]),e},Ue=e=>{const{lang:t,apiUri:i,bundleLabels:n={},pageSize:r=je}=e,s=F(e,Pe),{params:o,searchResults:a,loadMore:l}=Ae(i,n,r,t),[u,d]=M(o.q||""),h=Fe(),p=f=>{h.cancel(),f=f.trim(),(!f||f.length>=J)&&f!==o.q&&h(()=>{j.replace({q:f||void 0})},500)},{filters:g,status:_,items:y,hits:m,totalHits:b}=a,I=g&&(f=>{var k;j.replace({q:o.q,type:(k=g[f])==null?void 0:k.name})}),v=g&&Math.max(0,g.findIndex(f=>o.type===f.name));return c(P,{children:[c(pe,{label:s.searchInputLabel,placeholder:s.searchPlaceholder,buttonText:s.searchButtonText,value:u,onChange:f=>{const k=f.currentTarget.value;d(k),p(k)}}),_&&o.q&&c(Le,{status:_,items:y,totalHits:b,hits:m,pageSize:r,query:o.q,activeFilterIdx:v,filters:g,setFilter:I,loadMore:l,lang:t})]})},Be=e=>{const{insertAt:t,apiUri:i,bundleLabels:n,pageSize:r}=e;if(!i||!n){!i&&T("`apiUri` missing"),!n&&T("`bundleLabels` missing");return}const s=document.querySelector(t);if(!s){T('Insertion point "'+t+'" not found');return}se("SearchResults","SiteSearchInput").then(()=>{const o=document.createElement("div");o.className="SiteSearchPage",ee.render(c(Ue,{apiUri:i,bundleLabels:n,pageSize:r,lang:oe(s)}),o,()=>{s.replaceWith(o)})})};export{Be as default};
