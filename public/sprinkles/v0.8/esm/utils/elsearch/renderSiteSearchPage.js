import"../../../_chunks/initHannaNamespace-6bddf944.js";import{_ as x,h as V,T as N,p as T,y as ee,k as te,a as P,F as U,C as re}from"../../../_chunks/compat.module-6d0944a1.js";import{m as ne,p as C,r as ie,i as se,k as ae}from"../../../_chunks/qj-b9335549.js";import{D as F,g as D}from"../../../_chunks/i18n-45294c51.js";import{I as oe}from"../../../_chunks/_Image-3934084a.js";import{L as le}from"../../../_chunks/_Link-7f48f5da.js";import{o as c}from"../../../_chunks/jsxRuntime.module-98db1a52.js";import{u as ue}from"../../../_chunks/_useMobileMenuToggling-5fde4833.js";import{A as ce}from"../../../_chunks/Alert-4d7d517c.js";import{T as de}from"../../../_chunks/Tabs-3ba0b43c.js";import{S as he}from"../../../_chunks/SiteSearchInput-50a7961b.js";import"../../../_chunks/getSVGtext-bab5132d.js";import{e as pe}from"../../../_chunks/ensureCSS-7fca1df1.js";import{g as me}from"../../../_chunks/getLang-e1e8bdd7.js";import{searchResultsPageQuery as ge,postQuery as fe}from"./reykjavik.is.js";import"../../../_chunks/_Button-3fca7562.js";import"../../../_chunks/env-dad6c8ea.js";import"../../../_chunks/assets-d1dc561b.js";const L={is:["jan\xFAar","febr\xFAar","mars","apr\xEDl","ma\xED","j\xFAn\xED","j\xFAl\xED","\xE1g\xFAst","september","okt\xF3ber","n\xF3vember","desember"],en:["January","February","March","April","May","June","July","August","September","Oct\xF3ber","November","December"],pl:["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","wrze\u015Bnia","pa\u017Adziernika","listopada","grudnia"]},ye=(e,t)=>{e=typeof e=="string"?new Date(e):e;const i=e.getUTCDate(),n=L[t||F]||L[F],r=n[e.getUTCMonth()],s=e.getUTCFullYear();return n===L.en?`${r} ${i}, ${s}`:`${i}. ${r} ${s}`};function O(){return O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},O.apply(this,arguments)}function ve(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,j(e,t)}function j(e,t){return j=Object.setPrototypeOf||function(i,n){return i.__proto__=n,i},j(e,t)}function be(e,t){if(e==null)return{};var i={},n=Object.keys(e),r,s;for(s=0;s<n.length;s++)r=n[s],!(t.indexOf(r)>=0)&&(i[r]=e[r]);return i}var E=new Map,H=new WeakMap,Q=0,we=void 0;function Se(e){return e?(H.has(e)||(Q+=1,H.set(e,Q.toString())),H.get(e)):"0"}function ke(e){return Object.keys(e).sort().filter(function(t){return e[t]!==void 0}).map(function(t){return t+"_"+(t==="root"?Se(e.root):e[t])}).toString()}function _e(e){var t=ke(e),i=E.get(t);if(!i){var n=new Map,r,s=new IntersectionObserver(function(a){a.forEach(function(o){var l,u=o.isIntersecting&&r.some(function(d){return o.intersectionRatio>=d});e.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=u),(l=n.get(o.target))==null||l.forEach(function(d){d(u,o)})})},e);r=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:s,elements:n},E.set(t,i)}return i}function B(e,t,i,n){if(i===void 0&&(i={}),n===void 0&&(n=we),typeof window.IntersectionObserver>"u"&&n!==void 0){var r=e.getBoundingClientRect();return t(n,{isIntersecting:n,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:r,intersectionRect:r,rootBounds:r}),function(){}}var s=_e(i),a=s.id,o=s.observer,l=s.elements,u=l.get(e)||[];return l.has(e)||l.set(e,u),u.push(t),o.observe(e),function(){u.splice(u.indexOf(t),1),u.length===0&&(l.delete(e),o.unobserve(e)),l.size===0&&(o.disconnect(),E.delete(a))}}var Ie=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function $(e){return typeof e.children!="function"}var W=function(e){ve(t,e);function t(n){var r;return r=e.call(this,n)||this,r.node=null,r._unobserveCb=null,r.handleNode=function(s){r.node&&(r.unobserve(),!s&&!r.props.triggerOnce&&!r.props.skip&&r.setState({inView:!!r.props.initialInView,entry:void 0})),r.node=s||null,r.observeNode()},r.handleChange=function(s,a){s&&r.props.triggerOnce&&r.unobserve(),$(r.props)||r.setState({inView:s,entry:a}),r.props.onChange&&r.props.onChange(s,a)},r.state={inView:!!n.initialInView,entry:void 0},r}var i=t.prototype;return i.componentDidUpdate=function(n){(n.rootMargin!==this.props.rootMargin||n.root!==this.props.root||n.threshold!==this.props.threshold||n.skip!==this.props.skip||n.trackVisibility!==this.props.trackVisibility||n.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},i.componentWillUnmount=function(){this.unobserve(),this.node=null},i.observeNode=function(){if(!(!this.node||this.props.skip)){var n=this.props,r=n.threshold,s=n.root,a=n.rootMargin,o=n.trackVisibility,l=n.delay,u=n.fallbackInView;this._unobserveCb=B(this.node,this.handleChange,{threshold:r,root:s,rootMargin:a,trackVisibility:o,delay:l},u)}},i.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},i.render=function(){if(!$(this.props)){var n=this.state,r=n.inView,s=n.entry;return this.props.children({inView:r,entry:s,ref:this.handleNode})}var a=this.props,o=a.children,l=a.as,u=be(a,Ie);return ee(l||"div",O({ref:this.handleNode},u),o)},t}(te);W.displayName="InView",W.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function Me(e){var t=e===void 0?{}:e,i=t.threshold,n=t.delay,r=t.trackVisibility,s=t.rootMargin,a=t.root,o=t.triggerOnce,l=t.skip,u=t.initialInView,d=t.fallbackInView,h=x(),p=V({inView:!!u}),f=p[0],k=p[1],v=N(function(b){h.current!==void 0&&(h.current(),h.current=void 0),!l&&b&&(h.current=B(b,function(I,y){k({inView:I,entry:y}),y.isIntersecting&&o&&h.current&&(h.current(),h.current=void 0)},{root:a,rootMargin:s,threshold:i,trackVisibility:r,delay:n},d))},[Array.isArray(i)?i.toString():i,a,s,o,l,r,d,n]);T(function(){!h.current&&f.entry&&!o&&!l&&k({inView:!!u})});var m=[v,f.inView,f.entry];return m.ref=m[0],m.inView=m[1],m.entry=m[2],m}const J=e=>{const{highlight:t,title:i,summary:n,href:r,meta:s,image:a}=e,o=t?"SearchResultsHighlightItem":"SearchResultsItem",l=Array.isArray(s)?s:[s];return c("li",{className:o,children:c(le,{className:o+"__link",href:r,children:[c("h3",{className:o+"__title",children:i}),l.length>0&&c("span",{className:o+"__meta",children:l.map((u,d)=>typeof u=="function"?u():u&&c("span",{children:u},d))}),t&&a&&c(oe,{bem:o+"__image",src:a}),c("div",{className:o+"__summary",dangerouslySetInnerHTML:{__html:n}})]})})},Ve=()=>c(P,{children:["\xDAps, \xFEa\xF0 hefur komi\xF0 upp villa. M\xE1 bj\xF3\xF0a \xFE\xE9r a\xF0 pr\xF3fa aftur a\xF0 leita?",c("br",{}),"Ef ekkert l\xE1t er \xE1 villunni \xFE\xE1 kunnum vi\xF0 a\xF0 meta a\xF0 \xFE\xFA l\xE1tir okkur vita."]}),Te={en:{lang:"en",loadQueryTitle:"Loading results...",resultsTitle:"results found for",noResultsTitle:"No results were found for",loadMore:"Load more"},is:{lang:"is",loadQueryTitle:"S\xE6ki ni\xF0urst\xF6\xF0ur...",resultsTitle:"leitarni\xF0urst\xF6\xF0ur fyrir",noResultsTitle:"Engar leitarni\xF0urst\xF6\xF0ur fundust fyrir",loadMore:"S\xE6kja fleiri"},pl:{lang:"pl",loadQueryTitle:"\u0141adowanie wynik\xF3w...",resultsTitle:"wyniki wyszukiwania dla",noResultsTitle:"Nie znaleziono wynik\xF3w dla",loadMore:"Za\u0142aduj wi\u0119cej"}},qe=e=>{const{domid:t,filters:i,activeIdx:n,setFilter:r,lang:s}=e,a=U(()=>(i||[]).map(({label:o,count:l})=>({label:o,badge:C(l,{lang:s})})),[i,s]);return a.length?c(de,{role:"tablist","aria-controls":t,tabs:a,activeIdx:n||0,onSetActive:o=>r&&r(o)}):null},Y=e=>e.count?c("ol",{className:"SearchResults__list SearchResults__list--loading",children:ie(1,e.count).map((t,i)=>c(J,{title:"...",summary:"",href:""},i))}):null,xe=2,Ne=e=>{const{status:t,hits:i,numItems:n,loadMore:r,pageSize:s,texts:a}=e,{lang:o}=a,l=(i||0)-(n||0),u=x(0),d=!r||u.current>=xe,[h,p]=Me({rootMargin:"150px 0px 0px 0px",skip:d});return T(()=>{p&&r&&(u.current=u.current+1,r())},[p,r]),t==="loadingmore"?c(Y,{count:Math.min(s,l)}):t==="results"&&l&&r?c("button",{ref:h,className:"SearchResults__loadmore",type:"button",onClick:r,children:[a.loadMore," ",c("span",{className:"SearchResults__loadmore__count",children:["(",C(l,{lang:o}),")"]})]}):null},Re=(e,t)=>{const{status:i,totalHits:n,query:r}=e;return c("h2",{className:"SearchResults__title",children:[i==="loadingquery"?t.loadQueryTitle:n?C(n,{lang:t.lang})+" "+t.resultsTitle:t.noResultsTitle,c("span",{className:"SearchResults__query",children:r})]})},ze=e=>{const{status:t,pageSize:i,items:n,hits:r}=e;return t==="loadingquery"||t==="loadingfilter"?c(Y,{count:Math.min(i,r||999)}):n&&n.length?c("ol",{className:"SearchResults__list",children:n.map((s,a)=>c(J,{...s},a))}):null},Ce=(e,t)=>{const{hits:i,items:n,status:r,pageSize:s,loadMore:a}=e;return c(Ne,{hits:i,numItems:n&&n.length,status:r,pageSize:s,loadMore:a,texts:t})},Le=e=>{const{filters:t,activeFilterIdx:i,setFilter:n,status:r,errorText:s,wrapperProps:a}=e,o=D(e,Te),l=ue();return c("div",{...a,className:ne("SearchResults",r!=="results"&&r,(a||{}).className),children:[Re(e,o),c(qe,{domid:l,filters:t,activeIdx:i,setFilter:n,lang:o.lang}),c("div",{className:"SearchResults__results",id:l,children:[ze(e),r==="error"&&c(ce,{type:"error",children:s||Ve()}),Ce(e,o)]})]})},R=(...e)=>console.error("renderSiteSearchPage: ",...e),z=document.createElement("div"),Oe=(e,t)=>(e=e.trim(),e.indexOf(t)===0?e.slice(t.length).trim():e),je=(e,t)=>e?(z.innerHTML=e,z.textContent=Oe(z.textContent,t),z.innerHTML):"",Z=e=>e&&e[0]!=null?e[0].value:"",Ee=(e,t)=>e.map(i=>{const{label:n,url_alias:r,url_internal:s,field_date:a,field_summary:o,rendered_search_result:l}=i,u=[],d=Z(a);return d&&u.push(ye(d,t)),{title:n,meta:u.length?u:void 0,summary:Z(o)||je(l,n),href:r||s}}),He=(e,t)=>{const{aggregateData:i={},totalHits:n}=t||{};return e.map(({name:r,label:s})=>({name:r,label:s,count:(r?i[r]:n)||0})).filter(r=>r.count>0)},Ae=e=>Object.entries({"":"Allt",...e}).map(([t,i])=>({name:t||"",label:i})),Pe=10,G=2,Ue={en:{searchInputLabel:"Enter your search query",searchPlaceholder:"Enter your search query",searchButtonText:"Search"},is:{searchInputLabel:"Sl\xE1\xF0u inn leitaror\xF0",searchPlaceholder:"Sl\xE1\xF0u inn leitaror\xF0",searchButtonText:"Leita"},pl:{searchInputLabel:"Wpisz wyszukiwane s\u0142owa",searchPlaceholder:"Wpisz wyszukiwane s\u0142owa",searchButtonText:"Szukaj"}},A={push:(e,t)=>{const i=t?"replaceState":"pushState",n=ae(e),r=n?"?"+n:"";history[i](null,"",r),window.dispatchEvent(new Event("minirouting"))},replace:e=>A.push(e,!0)},K=(e={})=>{const t=new URLSearchParams(window.location.search),i=t.get("q")||void 0,n=t.get("type")||void 0;return i!==e.q||n!==e.type?{q:i,type:n}:e},Fe=(e,t,i,n)=>{const r=U(()=>Ae(t),[t]),[s,a]=V(K),o=x({}),l=N(()=>{a(v=>(o.current=v,K(v)))},[]),[,u]=V(0);T(()=>(window.addEventListener("popstate",l),window.addEventListener("minirouting",l),()=>{window.removeEventListener("popstate",l),window.removeEventListener("minirouting",l)}),[l]);const[d,h]=V({items:[]}),p=x(),f=N((v=0)=>{const{q:m,type:b}=s,I=o.current,y=m!==I.q?"loadingquery":b!==I.type?"loadingfilter":v>0?"loadingmore":void 0;if(!y||!m||m.length<G)return;h(w=>{var S,M;return{status:y,totalHits:y==="loadingquery"?void 0:w.totalHits,hits:y==="loadingquery"||(M=(S=w.filters)==null?void 0:S.find(q=>q.name===b))==null?void 0:M.count,items:y==="loadingmore"?w.items:[],filters:y==="loadingquery"?r.slice(0,1):w.filters}});const g=new AbortController,_=ge({value:m,filter:b&&r.find(w=>w.name===b)?[{term:{bundle:b}}]:void 0,from:v*i,size:i});return fe(e,_,g.signal).then(w=>{const[S,M]=w;if(!S||!M)throw new Error("query returned incomplete results");const q=Ee(M.items,n);h(X=>({status:"results",totalHits:S.totalHits,hits:b?M.totalHits:S.totalHits,items:y==="loadingmore"?X.items.concat(q):q,filters:He(r,S)})),l(),p.current=void 0}).catch(w=>{g.signal.aborted||(p.current=void 0,R(w),h(S=>({...S,status:"error"})))}),()=>g.abort()},[s,r,i,e,l,n]);T(()=>(u(0),p.current&&p.current(),p.current=f(),()=>{p.current&&p.current()}),[f]);const k=N(()=>{p.current||u(v=>{const m=v+1;return p.current=f(m),m})},[f]);return{params:s,searchResults:d,loadMore:k}},De=()=>{const[e]=V(()=>se.d(500));return T(()=>e.cancel,[]),e},Qe=e=>{const{lang:t,apiUri:i,bundleLabels:n={},pageSize:r=Pe}=e,s=D(e,Ue),{params:a,searchResults:o,loadMore:l}=Fe(i,n,r,t),[u,d]=V(a.q||""),h=De(),p=g=>{h.cancel(),g=g.trim(),(!g||g.length>=G)&&g!==a.q&&h(()=>{A.replace({q:g||void 0})},500)},{filters:f,status:k,items:v,hits:m,totalHits:b}=o,I=f&&(g=>{var _;A.replace({q:a.q,type:(_=f[g])==null?void 0:_.name})}),y=f&&Math.max(0,f.findIndex(g=>a.type===g.name));return c(P,{children:[c(he,{label:s.searchInputLabel,placeholder:s.searchPlaceholder,buttonText:s.searchButtonText,value:u,onChange:g=>{const _=g.currentTarget.value;d(_),p(_)}}),k&&a.q&&c(Le,{status:k,items:v,totalHits:b,hits:m,pageSize:r,query:a.q,activeFilterIdx:y,filters:f,setFilter:I,loadMore:l,lang:t})]})},Be=e=>{const{insertAt:t,apiUri:i,bundleLabels:n,pageSize:r}=e;if(!i||!n){!i&&R("`apiUri` missing"),!n&&R("`bundleLabels` missing");return}const s=document.querySelector(t);if(!s){R('Insertion point "'+t+'" not found');return}pe("SearchResults","SiteSearchInput").then(()=>{const a=document.createElement("div");a.className="SiteSearchPage",re.render(c(Qe,{apiUri:i,bundleLabels:n,pageSize:r,lang:me(s)}),a,()=>{s.replaceWith(a)})})};export{Be as default};
