System.register(["../../initHannaNamespace.js","../../../_chunks/compat.module-36c495df.js","../../../_chunks/qj-9ff1fed3.js","../../../_chunks/useFormatMonitor-8de02688.js","../../../_chunks/utils-f31475b7.js","../../../_chunks/_Image-552e9fa2.js","../../../_chunks/_Link-54d20488.js","../../../_chunks/jsxRuntime.module-014dea07.js","../../../_chunks/Alert-4be110c8.js","../../../_chunks/Tabs-f624a91b.js","../../../_chunks/SiteSearchInput-9d2d7b62.js","./reykjavik.is.js","../../../_chunks/focus-visible-4a3df2ba.js","../../../_chunks/_Button-54266272.js","../../../_chunks/env-37710d01.js"],function(pe,Be){"use strict";var N,I,j,T,Q,D,C,A,B,z,L,W,$,G,K,Y,P,Z,J,X,ee,d,te,re,ne,se,ie;return{setters:[null,l=>{N=l.b,I=l.h,j=l.T,T=l.p,Q=l.y,D=l.k,C=l._,A=l.F,B=l.C},l=>{z=l.m,L=l.p,W=l.r,$=l.h,G=l.i,K=l.k},l=>{Y=l.h},l=>{P=l.a,Z=l.j,J=l.p},l=>{X=l.I},l=>{ee=l.L},l=>{d=l.o},l=>{te=l.A},l=>{re=l.T},l=>{ne=l.S},l=>{se=l.searchResultsPageQuery,ie=l.postQuery},null,null,null],execute:function(){function l(){return l=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},l.apply(this,arguments)}function me(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,F(e,r)}function F(e,r){return F=Object.setPrototypeOf||function(s,t){return s.__proto__=t,s},F(e,r)}function ve(e,r){if(e==null)return{};var n={},s=Object.keys(e),t,i;for(i=0;i<s.length;i++)t=s[i],!(r.indexOf(t)>=0)&&(n[t]=e[t]);return n}var H=new Map,x=new WeakMap,oe=0,ye=void 0;function _e(e){return e?(x.has(e)||(oe+=1,x.set(e,oe.toString())),x.get(e)):"0"}function be(e){return Object.keys(e).sort().filter(function(r){return e[r]!==void 0}).map(function(r){return r+"_"+(r==="root"?_e(e.root):e[r])}).toString()}function Se(e){var r=be(e),n=H.get(r);if(!n){var s=new Map,t,i=new IntersectionObserver(function(a){a.forEach(function(o){var c,u=o.isIntersecting&&t.some(function(h){return o.intersectionRatio>=h});e.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=u),(c=s.get(o.target))==null||c.forEach(function(h){h(u,o)})})},e);t=i.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:r,observer:i,elements:s},H.set(r,n)}return n}function ae(e,r,n,s){if(n===void 0&&(n={}),s===void 0&&(s=ye),typeof window.IntersectionObserver>"u"&&s!==void 0){var t=e.getBoundingClientRect();return r(s,{isIntersecting:s,target:e,intersectionRatio:typeof n.threshold=="number"?n.threshold:0,time:0,boundingClientRect:t,intersectionRect:t,rootBounds:t}),function(){}}var i=Se(n),a=i.id,o=i.observer,c=i.elements,u=c.get(e)||[];return c.has(e)||c.set(e,u),u.push(r),o.observe(e),function(){u.splice(u.indexOf(r),1),u.length===0&&(c.delete(e),o.unobserve(e)),c.size===0&&(o.disconnect(),H.delete(a))}}var ke=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function le(e){return typeof e.children!="function"}var ce=function(e){me(r,e);function r(s){var t;return t=e.call(this,s)||this,t.node=null,t._unobserveCb=null,t.handleNode=function(i){t.node&&(t.unobserve(),!i&&!t.props.triggerOnce&&!t.props.skip&&t.setState({inView:!!t.props.initialInView,entry:void 0})),t.node=i||null,t.observeNode()},t.handleChange=function(i,a){i&&t.props.triggerOnce&&t.unobserve(),le(t.props)||t.setState({inView:i,entry:a}),t.props.onChange&&t.props.onChange(i,a)},t.state={inView:!!s.initialInView,entry:void 0},t}var n=r.prototype;return n.componentDidUpdate=function(t){(t.rootMargin!==this.props.rootMargin||t.root!==this.props.root||t.threshold!==this.props.threshold||t.skip!==this.props.skip||t.trackVisibility!==this.props.trackVisibility||t.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},n.componentWillUnmount=function(){this.unobserve(),this.node=null},n.observeNode=function(){if(!(!this.node||this.props.skip)){var t=this.props,i=t.threshold,a=t.root,o=t.rootMargin,c=t.trackVisibility,u=t.delay,h=t.fallbackInView;this._unobserveCb=ae(this.node,this.handleChange,{threshold:i,root:a,rootMargin:o,trackVisibility:c,delay:u},h)}},n.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},n.render=function(){if(!le(this.props)){var t=this.state,i=t.inView,a=t.entry;return this.props.children({inView:i,entry:a,ref:this.handleNode})}var o=this.props,c=o.children,u=o.as,h=ve(o,ke);return Q(u||"div",l({ref:this.handleNode},h),c)},r}(D);ce.displayName="InView",ce.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function Ie(e){var r=e===void 0?{}:e,n=r.threshold,s=r.delay,t=r.trackVisibility,i=r.rootMargin,a=r.root,o=r.triggerOnce,c=r.skip,u=r.initialInView,h=r.fallbackInView,f=N(),g=I({inView:!!u}),v=g[0],w=g[1],_=j(function(b){f.current!==void 0&&(f.current(),f.current=void 0),!c&&b&&(f.current=ae(b,function(V,y){w({inView:V,entry:y}),y.isIntersecting&&o&&f.current&&(f.current(),f.current=void 0)},{root:a,rootMargin:i,threshold:n,trackVisibility:t,delay:s},h))},[Array.isArray(n)?n.toString():n,a,i,o,c,t,h,s]);T(function(){!f.current&&v.entry&&!o&&!c&&w({inView:!!u})});var p=[_,v.inView,v.entry];return p.ref=p[0],p.inView=p[1],p.entry=p[2],p}const ue=e=>{const{highlight:r,title:n,summary:s,href:t,meta:i,image:a}=e,o=r?"SearchResultsHighlightItem":"SearchResultsItem",c=Array.isArray(i)?i:[i];return d("li",{className:o,children:d(ee,{className:o+"__link",href:t,children:[d("h3",{className:o+"__title",children:n}),c.length>0&&d("span",{className:o+"__meta",children:c.map((u,h)=>typeof u=="function"?u():u&&d("span",{children:u},h))}),r&&a&&d(X,{bem:o+"__image",src:a}),d("div",{className:o+"__summary",dangerouslySetInnerHTML:{__html:s}})]})})},we=()=>d(C,{children:["Úps, það hefur komið upp villa. Má bjóða þér að prófa aftur að leita?",d("br",{}),"Ef ekkert lát er á villunni þá kunnum við að meta að þú látir okkur vita."]}),Re={en:{lang:"en",loadQueryTitle:"Loading results...",resultsTitle:"results found for",noResultsTitle:"No results were found for",loadMore:"Load more"},is:{lang:"is",loadQueryTitle:"Sæki niðurstöður...",resultsTitle:"leitarniðurstöður fyrir",noResultsTitle:"Engar leitarniðurstöður fundust fyrir",loadMore:"Sækja fleiri"}},Te=e=>{const{domid:r,filters:n,activeIdx:s,setFilter:t,lang:i}=e,a=A(()=>(n||[]).map(({label:o,count:c})=>({label:o,badge:L(c,{lang:i})})),[n,i]);return a.length?d(re,{role:"tablist","aria-controls":r,tabs:a,activeIdx:s||0,onSetActive:o=>t&&t(o)}):null},de=e=>e.count?d("ol",{className:"SearchResults__list SearchResults__list--loading",children:W(1,e.count).map((r,n)=>d(ue,{title:"...",summary:"",href:""},n))}):null,Ve=2,Me=e=>{const{status:r,hits:n,numItems:s,loadMore:t,pageSize:i,texts:a}=e,{lang:o}=a,c=(n||0)-(s||0),u=N(0),h=!t||u.current>=Ve,[f,g]=Ie({rootMargin:"150px 0px 0px 0px",skip:h});return T(()=>{g&&t&&(u.current=u.current+1,t())},[g,t]),r==="loadingmore"?d(de,{count:Math.min(i,c)}):r==="results"&&c&&t?d("button",{ref:f,className:"SearchResults__loadmore",type:"button",onClick:t,children:[a.loadMore," ",d("span",{className:"SearchResults__loadmore__count",children:["(",L(c,{lang:o}),")"]})]}):null},Ne=(e,r)=>{const{status:n,totalHits:s,query:t}=e;return d("h2",{className:"SearchResults__title",children:[n==="loadingquery"?r.loadQueryTitle:s?L(s,{lang:r.lang})+" "+r.resultsTitle:r.noResultsTitle,d("span",{className:"SearchResults__query",children:t})]})},je=e=>{const{status:r,pageSize:n,items:s,hits:t}=e;return r==="loadingquery"||r==="loadingfilter"?d(de,{count:Math.min(n,t||999)}):s&&s.length?d("ol",{className:"SearchResults__list",children:s.map((i,a)=>d(ue,{...i},a))}):null},Le=(e,r)=>{const{hits:n,items:s,status:t,pageSize:i,loadMore:a}=e;return d(Me,{hits:n,numItems:s&&s.length,status:t,pageSize:i,loadMore:a,texts:r})},xe=e=>{const{filters:r,activeFilterIdx:n,setFilter:s,status:t,errorText:i,wrapperProps:a}=e,o=P(e,Re),c=Y.useDomid();return d("div",{...a,className:z("SearchResults",t!=="results"&&t,(a||{}).className),children:[Ne(e,o),d(Te,{domid:c,filters:r,activeIdx:n,setFilter:s,lang:o.lang}),d("div",{className:"SearchResults__results",id:c,children:[je(e),t==="error"&&d(te,{type:"error",children:i||we()}),Le(e,o)]})]})},O=(...e)=>console.error("renderSiteSearchPage: ",...e),E=document.createElement("div"),Oe=(e,r)=>(e=e.trim(),e.indexOf(r)===0?e.slice(r.length).trim():e),Ee=(e,r)=>e?(E.innerHTML=e,E.textContent=Oe(E.textContent,r),E.innerHTML):"",he=e=>e&&e[0]!=null?e[0].value:"",qe=(e,r)=>e.map(n=>{const{label:s,url_alias:t,url_internal:i,field_date:a,field_summary:o,rendered_search_result:c}=n,u=[],h=he(a);return h&&u.push(J(h,r)),{title:s,meta:u.length?u:void 0,summary:he(o)||Ee(c,s),href:t||i}}),Ce=(e,r)=>{const{aggregateData:n={},totalHits:s}=r||{};return e.map(({name:t,label:i})=>({name:t,label:i,count:(t?n[t]:s)||0})).filter(t=>t.count>0)},Ae=e=>Object.entries({"":"Allt",...e}).map(([r,n])=>({name:r||"",label:n})),Pe=10,fe=2,Fe={en:{searchInputLabel:"Enter your search query",searchPlaceholder:"Enter your search query",searchButtonText:"Search"},is:{searchInputLabel:"Sláðu inn leitarorð",searchPlaceholder:"Sláðu inn leitarorð",searchButtonText:"Leita"}},U={push:(e,r)=>{const n=r?"replaceState":"pushState",s=K(e),t=s?"?"+s:"";history[n](null,"",t),window.dispatchEvent(new Event("minirouting"))},replace:e=>U.push(e,!0)},ge=(e={})=>{const r=new URLSearchParams(window.location.search),n=r.get("q")||void 0,s=r.get("type")||void 0;return n!==e.q||s!==e.type?{q:n,type:s}:e},He=(e,r,n,s)=>{const t=A(()=>Ae(r),[r]),[i,a]=I(ge),o=N({}),c=j(()=>{a(_=>(o.current=_,ge(_)))},[]),[,u]=I(0);T(()=>(window.addEventListener("popstate",c),window.addEventListener("minirouting",c),()=>{window.removeEventListener("popstate",c),window.removeEventListener("minirouting",c)}),[c]);const[h,f]=I({items:[]}),g=N(),v=j((_=0)=>{const{q:p,type:b}=i,V=o.current,y=p!==V.q?"loadingquery":b!==V.type?"loadingfilter":_>0?"loadingmore":void 0;if(!y||!p||p.length<fe)return;f(S=>{var k,M;return{status:y,totalHits:y==="loadingquery"?void 0:S.totalHits,hits:y==="loadingquery"||(M=(k=S.filters)==null?void 0:k.find(q=>q.name===b))==null?void 0:M.count,items:y==="loadingmore"?S.items:[],filters:y==="loadingquery"?t.slice(0,1):S.filters}});const m=new AbortController,R=se({value:p,filter:b&&t.find(S=>S.name===b)?[{term:{bundle:b}}]:void 0,from:_*n,size:n});return ie(e,R,m.signal).then(S=>{const[k,M]=S;if(!k||!M)throw new Error("query returned incomplete results");const q=qe(M.items,s);f(De=>({status:"results",totalHits:k.totalHits,hits:b?M.totalHits:k.totalHits,items:y==="loadingmore"?De.items.concat(q):q,filters:Ce(t,k)})),c(),g.current=void 0}).catch(S=>{m.signal.aborted||(g.current=void 0,O(S),f(k=>({...k,status:"error"})))}),()=>m.abort()},[i,t,n,e,c,s]);T(()=>(u(0),g.current&&g.current(),g.current=v(),()=>{g.current&&g.current()}),[v]);const w=j(()=>{g.current||u(_=>{const p=_+1;return g.current=v(p),p})},[v]);return{params:i,searchResults:h,loadMore:w}},Ue=()=>{const[e]=I(()=>G.d(500));return T(()=>e.cancel,[]),e},Qe=e=>{const{lang:r,apiUri:n,bundleLabels:s={},pageSize:t=Pe}=e,i=P(e,Fe),{params:a,searchResults:o,loadMore:c}=He(n,s,t,r),[u,h]=I(a.q||""),f=Ue(),g=m=>{f.cancel(),m=m.trim(),(!m||m.length>=fe)&&m!==a.q&&f(()=>{U.replace({q:m||void 0})},500)},{filters:v,status:w,items:_,hits:p,totalHits:b}=o,V=v&&(m=>{var R;U.replace({q:a.q,type:(R=v[m])==null?void 0:R.name})}),y=v&&Math.max(0,v.findIndex(m=>a.type===m.name));return d(C,{children:[d(ne,{label:i.searchInputLabel,placeholder:i.searchPlaceholder,buttonText:i.searchButtonText,value:u,onChange:m=>{const R=m.currentTarget.value;h(R),g(R)}}),w&&a.q&&d(xe,{status:w,items:_,totalHits:b,hits:p,pageSize:t,query:a.q,activeFilterIdx:y,filters:v,setFilter:V,loadMore:c,lang:r})]})},ze=pe("default",e=>{const{insertAt:r,apiUri:n,bundleLabels:s,pageSize:t}=e;if(!n||!s){!n&&O("`apiUri` missing"),!s&&O("`bundleLabels` missing");return}const i=document.querySelector(r);if(!i){O('Insertion point "'+r+'" not found');return}Z("SearchResults","SiteSearchInput").then(()=>{const a=document.createElement("div");a.className="SiteSearchPage";const o=$();B.render(d(Qe,{apiUri:n,bundleLabels:s,pageSize:t,lang:o}),a,()=>{i.replaceWith(a)})})})}}});
