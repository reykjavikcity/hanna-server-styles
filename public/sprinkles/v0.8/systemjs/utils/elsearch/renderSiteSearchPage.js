System.register(["../../initHannaNamespace.js","../../../_chunks/compat.module-a402cbb4.js","../../../_chunks/qj-7a691f7a.js","../../../_chunks/utils-912f90e8.js","../../../_chunks/_Image-2d51ed4a.js","../../../_chunks/_Link-2be16f36.js","../../../_chunks/jsxRuntime.module-9909fe88.js","../../../_chunks/useFormatMonitor-7bb96c94.js","../../../_chunks/Alert-b03a7391.js","../../../_chunks/Tabs-7b77bfa3.js","../../../_chunks/SiteSearchInput-19e7f6bd.js","./reykjavik.is.js","../focus-visible.js","../../../_chunks/_Button-aa240991.js","../../../_chunks/env-18ca5c43.js"],function(ge,De){"use strict";var j,k,N,T,U,Q,C,A,D,B,L,W,$,G,P,Z,K,Y,J,X,d,ee,te,re,ne,ie,se;return{setters:[null,l=>{j=l.a,k=l.h,N=l.T,T=l.p,U=l.y,Q=l.k,C=l._,A=l.F,D=l.C},l=>{B=l.m,L=l.p,W=l.r,$=l.i,G=l.n},l=>{P=l.b,Z=l.e,K=l.c,Y=l.p},l=>{J=l.I},l=>{X=l.L},l=>{d=l.o},l=>{ee=l.u},l=>{te=l.A},l=>{re=l.T},l=>{ne=l.S},l=>{ie=l.searchResultsPageQuery,se=l.postQuery},null,null,null],execute:function(){function l(){return l=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},l.apply(this,arguments)}function me(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,F(e,r)}function F(e,r){return F=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i},F(e,r)}function ve(e,r){if(e==null)return{};var n={},i=Object.keys(e),t,s;for(s=0;s<i.length;s++)t=i[s],!(r.indexOf(t)>=0)&&(n[t]=e[t]);return n}var H=new Map,x=new WeakMap,oe=0,ye=void 0;function be(e){return e?(x.has(e)||(oe+=1,x.set(e,oe.toString())),x.get(e)):"0"}function _e(e){return Object.keys(e).sort().filter(function(r){return e[r]!==void 0}).map(function(r){return r+"_"+(r==="root"?be(e.root):e[r])}).toString()}function Se(e){var r=_e(e),n=H.get(r);if(!n){var i=new Map,t,s=new IntersectionObserver(function(o){o.forEach(function(a){var c,u=a.isIntersecting&&t.some(function(h){return a.intersectionRatio>=h});e.trackVisibility&&typeof a.isVisible>"u"&&(a.isVisible=u),(c=i.get(a.target))==null||c.forEach(function(h){h(u,a)})})},e);t=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),n={id:r,observer:s,elements:i},H.set(r,n)}return n}function ae(e,r,n,i){if(n===void 0&&(n={}),i===void 0&&(i=ye),typeof window.IntersectionObserver>"u"&&i!==void 0){var t=e.getBoundingClientRect();return r(i,{isIntersecting:i,target:e,intersectionRatio:typeof n.threshold=="number"?n.threshold:0,time:0,boundingClientRect:t,intersectionRect:t,rootBounds:t}),function(){}}var s=Se(n),o=s.id,a=s.observer,c=s.elements,u=c.get(e)||[];return c.has(e)||c.set(e,u),u.push(r),a.observe(e),function(){u.splice(u.indexOf(r),1),u.length===0&&(c.delete(e),a.unobserve(e)),c.size===0&&(a.disconnect(),H.delete(o))}}var we=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function le(e){return typeof e.children!="function"}var ce=function(e){me(r,e);function r(i){var t;return t=e.call(this,i)||this,t.node=null,t._unobserveCb=null,t.handleNode=function(s){t.node&&(t.unobserve(),!s&&!t.props.triggerOnce&&!t.props.skip&&t.setState({inView:!!t.props.initialInView,entry:void 0})),t.node=s||null,t.observeNode()},t.handleChange=function(s,o){s&&t.props.triggerOnce&&t.unobserve(),le(t.props)||t.setState({inView:s,entry:o}),t.props.onChange&&t.props.onChange(s,o)},t.state={inView:!!i.initialInView,entry:void 0},t}var n=r.prototype;return n.componentDidUpdate=function(t){(t.rootMargin!==this.props.rootMargin||t.root!==this.props.root||t.threshold!==this.props.threshold||t.skip!==this.props.skip||t.trackVisibility!==this.props.trackVisibility||t.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},n.componentWillUnmount=function(){this.unobserve(),this.node=null},n.observeNode=function(){if(!(!this.node||this.props.skip)){var t=this.props,s=t.threshold,o=t.root,a=t.rootMargin,c=t.trackVisibility,u=t.delay,h=t.fallbackInView;this._unobserveCb=ae(this.node,this.handleChange,{threshold:s,root:o,rootMargin:a,trackVisibility:c,delay:u},h)}},n.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},n.render=function(){if(!le(this.props)){var t=this.state,s=t.inView,o=t.entry;return this.props.children({inView:s,entry:o,ref:this.handleNode})}var a=this.props,c=a.children,u=a.as,h=ve(a,we);return U(u||"div",l({ref:this.handleNode},h),c)},r}(Q);ce.displayName="InView",ce.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function ke(e){var r=e===void 0?{}:e,n=r.threshold,i=r.delay,t=r.trackVisibility,s=r.rootMargin,o=r.root,a=r.triggerOnce,c=r.skip,u=r.initialInView,h=r.fallbackInView,f=j(),p=k({inView:!!u}),v=p[0],I=p[1],b=N(function(_){f.current!==void 0&&(f.current(),f.current=void 0),!c&&_&&(f.current=ae(_,function(V,y){I({inView:V,entry:y}),y.isIntersecting&&a&&f.current&&(f.current(),f.current=void 0)},{root:o,rootMargin:s,threshold:n,trackVisibility:t,delay:i},h))},[Array.isArray(n)?n.toString():n,o,s,a,c,t,h,i]);T(function(){!f.current&&v.entry&&!a&&!c&&I({inView:!!u})});var g=[b,v.inView,v.entry];return g.ref=g[0],g.inView=g[1],g.entry=g[2],g}const ue=e=>{const{highlight:r,title:n,summary:i,href:t,meta:s,image:o}=e,a=r?"SearchResultsHighlightItem":"SearchResultsItem",c=Array.isArray(s)?s:[s];return d("li",{className:a,children:d(X,{className:a+"__link",href:t,children:[d("h3",{className:a+"__title",children:n}),c.length>0&&d("span",{className:a+"__meta",children:c.map((u,h)=>typeof u=="function"?u():u&&d("span",{children:u},h))}),r&&o&&d(J,{bem:a+"__image",src:o}),d("div",{className:a+"__summary",dangerouslySetInnerHTML:{__html:i}})]})})},Ie=()=>d(C,{children:["Úps, það hefur komið upp villa. Má bjóða þér að prófa aftur að leita?",d("br",{}),"Ef ekkert lát er á villunni þá kunnum við að meta að þú látir okkur vita."]}),Re={en:{lang:"en",loadQueryTitle:"Loading results...",resultsTitle:"results found for",noResultsTitle:"No results were found for",loadMore:"Load more"},is:{lang:"is",loadQueryTitle:"Sæki niðurstöður...",resultsTitle:"leitarniðurstöður fyrir",noResultsTitle:"Engar leitarniðurstöður fundust fyrir",loadMore:"Sækja fleiri"},pl:{lang:"pl",loadQueryTitle:"Ładowanie wyników...",resultsTitle:"wyniki wyszukiwania dla",noResultsTitle:"Nie znaleziono wyników dla",loadMore:"Załaduj więcej"}},Te=e=>{const{domid:r,filters:n,activeIdx:i,setFilter:t,lang:s}=e,o=A(()=>(n||[]).map(({label:a,count:c})=>({label:a,badge:L(c,{lang:s})})),[n,s]);return o.length?d(re,{role:"tablist","aria-controls":r,tabs:o,activeIdx:i||0,onSetActive:a=>t&&t(a)}):null},de=e=>e.count?d("ol",{className:"SearchResults__list SearchResults__list--loading",children:W(1,e.count).map((r,n)=>d(ue,{title:"...",summary:"",href:""},n))}):null,Ve=2,Me=e=>{const{status:r,hits:n,numItems:i,loadMore:t,pageSize:s,texts:o}=e,{lang:a}=o,c=(n||0)-(i||0),u=j(0),h=!t||u.current>=Ve,[f,p]=ke({rootMargin:"150px 0px 0px 0px",skip:h});return T(()=>{p&&t&&(u.current=u.current+1,t())},[p,t]),r==="loadingmore"?d(de,{count:Math.min(s,c)}):r==="results"&&c&&t?d("button",{ref:f,className:"SearchResults__loadmore",type:"button",onClick:t,children:[o.loadMore," ",d("span",{className:"SearchResults__loadmore__count",children:["(",L(c,{lang:a}),")"]})]}):null},je=(e,r)=>{const{status:n,totalHits:i,query:t}=e;return d("h2",{className:"SearchResults__title",children:[n==="loadingquery"?r.loadQueryTitle:i?L(i,{lang:r.lang})+" "+r.resultsTitle:r.noResultsTitle,d("span",{className:"SearchResults__query",children:t})]})},Ne=e=>{const{status:r,pageSize:n,items:i,hits:t}=e;return r==="loadingquery"||r==="loadingfilter"?d(de,{count:Math.min(n,t||999)}):i&&i.length?d("ol",{className:"SearchResults__list",children:i.map((s,o)=>d(ue,{...s},o))}):null},Le=(e,r)=>{const{hits:n,items:i,status:t,pageSize:s,loadMore:o}=e;return d(Me,{hits:n,numItems:i&&i.length,status:t,pageSize:s,loadMore:o,texts:r})},xe=e=>{const{filters:r,activeFilterIdx:n,setFilter:i,status:t,errorText:s,wrapperProps:o}=e,a=P(e,Re),c=ee();return d("div",{...o,className:B("SearchResults",t!=="results"&&t,(o||{}).className),children:[je(e,a),d(Te,{domid:c,filters:r,activeIdx:n,setFilter:i,lang:a.lang}),d("div",{className:"SearchResults__results",id:c,children:[Ne(e),t==="error"&&d(te,{type:"error",children:s||Ie()}),Le(e,a)]})]})},O=(...e)=>console.error("renderSiteSearchPage: ",...e),E=document.createElement("div"),Oe=(e,r)=>(e=e.trim(),e.indexOf(r)===0?e.slice(r.length).trim():e),Ee=(e,r)=>e?(E.innerHTML=e,E.textContent=Oe(E.textContent,r),E.innerHTML):"",he=e=>e&&e[0]!=null?e[0].value:"",qe=(e,r)=>e.map(n=>{const{label:i,url_alias:t,url_internal:s,field_date:o,field_summary:a,rendered_search_result:c}=n,u=[],h=he(o);return h&&u.push(Y(h,r)),{title:i,meta:u.length?u:void 0,summary:he(a)||Ee(c,i),href:t||s}}),Ce=(e,r)=>{const{aggregateData:n={},totalHits:i}=r||{};return e.map(({name:t,label:s})=>({name:t,label:s,count:(t?n[t]:i)||0})).filter(t=>t.count>0)},Ae=e=>Object.entries({"":"Allt",...e}).map(([r,n])=>({name:r||"",label:n})),Pe=10,fe=2,Fe={en:{searchInputLabel:"Enter your search query",searchPlaceholder:"Enter your search query",searchButtonText:"Search"},is:{searchInputLabel:"Sláðu inn leitarorð",searchPlaceholder:"Sláðu inn leitarorð",searchButtonText:"Leita"},pl:{searchInputLabel:"Wpisz wyszukiwane słowa",searchPlaceholder:"Wpisz wyszukiwane słowa",searchButtonText:"Szukaj"}},z={push:(e,r)=>{const n=r?"replaceState":"pushState",i=G(e),t=i?"?"+i:"";history[n](null,"",t),window.dispatchEvent(new Event("minirouting"))},replace:e=>z.push(e,!0)},pe=(e={})=>{const r=new URLSearchParams(window.location.search),n=r.get("q")||void 0,i=r.get("type")||void 0;return n!==e.q||i!==e.type?{q:n,type:i}:e},He=(e,r,n,i)=>{const t=A(()=>Ae(r),[r]),[s,o]=k(pe),a=j({}),c=N(()=>{o(b=>(a.current=b,pe(b)))},[]),[,u]=k(0);T(()=>(window.addEventListener("popstate",c),window.addEventListener("minirouting",c),()=>{window.removeEventListener("popstate",c),window.removeEventListener("minirouting",c)}),[c]);const[h,f]=k({items:[]}),p=j(),v=N((b=0)=>{const{q:g,type:_}=s,V=a.current,y=g!==V.q?"loadingquery":_!==V.type?"loadingfilter":b>0?"loadingmore":void 0;if(!y||!g||g.length<fe)return;f(S=>{var w,M;return{status:y,totalHits:y==="loadingquery"?void 0:S.totalHits,hits:y==="loadingquery"||(M=(w=S.filters)==null?void 0:w.find(q=>q.name===_))==null?void 0:M.count,items:y==="loadingmore"?S.items:[],filters:y==="loadingquery"?t.slice(0,1):S.filters}});const m=new AbortController,R=ie({value:g,filter:_&&t.find(S=>S.name===_)?[{term:{bundle:_}}]:void 0,from:b*n,size:n});return se(e,R,m.signal).then(S=>{const[w,M]=S;if(!w||!M)throw new Error("query returned incomplete results");const q=qe(M.items,i);f(Qe=>({status:"results",totalHits:w.totalHits,hits:_?M.totalHits:w.totalHits,items:y==="loadingmore"?Qe.items.concat(q):q,filters:Ce(t,w)})),c(),p.current=void 0}).catch(S=>{m.signal.aborted||(p.current=void 0,O(S),f(w=>({...w,status:"error"})))}),()=>m.abort()},[s,t,n,e,c,i]);T(()=>(u(0),p.current&&p.current(),p.current=v(),()=>{p.current&&p.current()}),[v]);const I=N(()=>{p.current||u(b=>{const g=b+1;return p.current=v(g),g})},[v]);return{params:s,searchResults:h,loadMore:I}},ze=()=>{const[e]=k(()=>$.d(500));return T(()=>e.cancel,[]),e},Ue=e=>{const{lang:r,apiUri:n,bundleLabels:i={},pageSize:t=Pe}=e,s=P(e,Fe),{params:o,searchResults:a,loadMore:c}=He(n,i,t,r),[u,h]=k(o.q||""),f=ze(),p=m=>{f.cancel(),m=m.trim(),(!m||m.length>=fe)&&m!==o.q&&f(()=>{z.replace({q:m||void 0})},500)},{filters:v,status:I,items:b,hits:g,totalHits:_}=a,V=v&&(m=>{var R;z.replace({q:o.q,type:(R=v[m])==null?void 0:R.name})}),y=v&&Math.max(0,v.findIndex(m=>o.type===m.name));return d(C,{children:[d(ne,{label:s.searchInputLabel,placeholder:s.searchPlaceholder,buttonText:s.searchButtonText,value:u,onChange:m=>{const R=m.currentTarget.value;h(R),p(R)}}),I&&o.q&&d(xe,{status:I,items:b,totalHits:_,hits:g,pageSize:t,query:o.q,activeFilterIdx:y,filters:v,setFilter:V,loadMore:c,lang:r})]})},Be=ge("default",e=>{const{insertAt:r,apiUri:n,bundleLabels:i,pageSize:t}=e;if(!n||!i){!n&&O("`apiUri` missing"),!i&&O("`bundleLabels` missing");return}const s=document.querySelector(r);if(!s){O('Insertion point "'+r+'" not found');return}Z("SearchResults","SiteSearchInput").then(()=>{const o=document.createElement("div");o.className="SiteSearchPage",D.render(d(Ue,{apiUri:n,bundleLabels:i,pageSize:t,lang:K(s)}),o,()=>{s.replaceWith(o)})})})}}});
