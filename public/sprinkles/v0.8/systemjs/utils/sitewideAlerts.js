System.register(["../../_chunks/compat.module-f329784f.js","../../_chunks/qj-0feb5801.js","../../_chunks/Alert-878c3f7c.js","../../_chunks/ensureCSS-8b7d0e4a.js","../../_chunks/getLang-45de5ff2.js","../../_chunks/jsxRuntime.module-2cafdad3.js","../../_chunks/getSVGtext-ef8676a9.js","../../_chunks/i18n-6c3e4ded.js","../../_chunks/_Button-4ce1d666.js","../../_chunks/_Link-7fe03f09.js","../../_chunks/env-60bbcb5a.js","../../_chunks/_useMobileMenuToggling-2178898f.js","../../_chunks/assets-cefd5009.js"],function(p,$){"use strict";var _,w,m,A,a,S,k,I,b,j,v,M,d;return{setters:[n=>{_=n.C,w=n.h,m=n.p,A=n.a},n=>{a=n.S,S=n.q,k=n.a,I=n.M,b=n.D},n=>{j=n.A},n=>{v=n.e},n=>{M=n.g},n=>{d=n.o},null,null,null,null,null,null,null],execute:function(){const n="alert-dismissed-",x=14*b,T=()=>{if(Math.random()>.1)return;const e=Math.floor((Date.now()-x)/a);for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&s.startsWith(n)&&Number(localStorage.getItem(s))<e&&localStorage.removeItem(s)}},E=e=>t=>{const s=t.showOnPages||[];if(s.length===0)return!0;const i=t.negateShowOnPages??!0;let r=!1;const o=window.location.pathname;for(let h=0;h<s.length;h++){const f=e.slice(0,-1)+s[h];if(f.charAt(f.length-1)==="*"){if(o.startsWith(f.substring(0,f.length-1))){r=!0;break}}else if(f===o){r=!0;break}}return i?!r:r},N=e=>!(e.dismissible&&(Number(localStorage.getItem(n+e.uuid))||-1)>=(e.dismissalIgnoreBefore||0)),C=(e,t)=>fetch(e).then(s=>s.json()).then(s=>{const i=s.sitewideAlerts,r=Math.ceil(Date.now()/a);return i.forEach(o=>{o.dismissible?(o.dismissalIgnoreBefore||0)>r&&(o.dismissible=!1):delete o.dismissalIgnoreBefore}),i.filter(N).filter(E(t))}).catch(s=>(console.error("Site wide alerts failed loading",s),[])),R=e=>{const t=Math.ceil(Date.now()/a);let s=!1;const i=e.map(r=>r.dismissible||r.dismissalIgnoreBefore||0>t?r:(s=!0,{...r,dismissible:!0}));return s?i:e},U=e=>{const t=Math.floor(Date.now()/a),i=e.filter(r=>(r.dismissalIgnoreBefore||-1)>t).reduce((r,{dismissalIgnoreBefore:o=0})=>r?Math.min(r,o):o,0)-t;return i>0?i:null},O={"alert-warning":"critical","alert-attention":"warning","alert-success":"success","alert-info":"info"},P=e=>{const{alertsUri:t,baseUrl:s="/",lang:i,refreshInterval:r}=e,[o,h]=w([]);m(()=>{const l=()=>{C(t,s).then(u=>{h(g=>g.length!==u.length||JSON.stringify(g)!==JSON.stringify(u)?u:g)})};l();const c=setInterval(l,r);return()=>{clearInterval(c)}},[t,s,r]),m(()=>{const l=U(o)||0;if(l>0){const c=setTimeout(()=>{h(R)},(l+2)*a);return()=>{clearTimeout(c)}}},[o]);const f=({uuid:l})=>{window.localStorage.setItem(n+l,String(Math.round(Date.now()/a))),setTimeout(()=>{h(c=>{const u=c.filter(g=>g.uuid!==l);return u.length<c.length?u:c})},2e3)};return d(A,{children:o.map(l=>{const{uuid:c,styleClass:u,renderedAlert:g=l.message,dismissible:D}=l,W=O[u]||"info";return d(j,{type:W,childrenHTML:g,onClose:D?()=>f(l):void 0,lang:i},c)})})},y=e=>{const t=document.createElement("div");return e.append(t),t},q=(e,t)=>{if(typeof e=="string"){const o=S(e);if(o)return o}else if(e)return e;const s=S(`.${t}__alerts`);if(s)return y(s);const i=document.createElement("div");return i.className=`${t}__alerts`,k(`.${t}, body`).slice(-1)[0].prepend(i),y(i)},B=10*a,L=2*I,F=p("default",e=>{T();const t=e.layoutName||"Layout",s=q(e.rootElm,t);v("Alert").then(()=>{const i=Math.max(e.refreshInterval||L,B);_.render(d(P,{alertsUri:e.alertsUri,baseUrl:e.baseUrl,refreshInterval:i,lang:M()}),s)})})}}});
