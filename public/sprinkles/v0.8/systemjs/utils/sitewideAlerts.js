System.register(["../../_chunks/compat.module-36c495df.js","../../_chunks/qj-9ff1fed3.js","../../_chunks/Alert-4be110c8.js","../../_chunks/utils-f31475b7.js","../../_chunks/jsxRuntime.module-014dea07.js","../../_chunks/_Button-54266272.js","../../_chunks/_Link-54d20488.js","../../_chunks/env-37710d01.js","../../_chunks/useFormatMonitor-8de02688.js"],function(p,W){"use strict";var _,w,g,A,I,a,S,b,v,k,y,D,m;return{setters:[n=>{_=n.C,w=n.h,g=n.p,A=n._},n=>{I=n.h,a=n.S,S=n.a,b=n.q,v=n.M,k=n.D},n=>{y=n.A},n=>{D=n.j},n=>{m=n.o},null,null,null,null],execute:function(){const n="alert-dismissed-",x=14*k,E=()=>{if(Math.random()>.1)return;const e=Math.floor((Date.now()-x)/a);for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&s.startsWith(n)&&Number(localStorage.getItem(s))<e&&localStorage.removeItem(s)}},T=e=>t=>{const s=t.showOnPages||[];if(s.length===0)return!0;const i=t.negateShowOnPages??!0;let r=!1;const o=window.location.pathname;for(let h=0;h<s.length;h++){const f=e.slice(0,-1)+s[h];if(f.charAt(f.length-1)==="*"){if(o.startsWith(f.substring(0,f.length-1))){r=!0;break}}else if(f===o){r=!0;break}}return i?!r:r},N=e=>!(e.dismissible&&(Number(localStorage.getItem(n+e.uuid))||-1)>=(e.dismissalIgnoreBefore||0)),R=(e,t)=>fetch(e).then(s=>s.json()).then(s=>{const i=s.sitewideAlerts,r=Math.ceil(Date.now()/a);return i.forEach(o=>{o.dismissible?(o.dismissalIgnoreBefore||0)>r&&(o.dismissible=!1):delete o.dismissalIgnoreBefore}),i.filter(N).filter(T(t))}).catch(s=>(console.error("Site wide alerts failed loading",s),[])),C=e=>{const t=Math.ceil(Date.now()/a);let s=!1;const i=e.map(r=>r.dismissible||r.dismissalIgnoreBefore||0>t?r:(s=!0,{...r,dismissible:!0}));return s?i:e},U=e=>{const t=Math.floor(Date.now()/a),i=e.filter(r=>(r.dismissalIgnoreBefore||-1)>t).reduce((r,{dismissalIgnoreBefore:o=0})=>r?Math.min(r,o):o,0)-t;return i>0?i:null},O={"alert-warning":"critical","alert-attention":"warning","alert-success":"success","alert-info":"info"},P=e=>{const{alertsUri:t,baseUrl:s="/",lang:i,refreshInterval:r}=e,[o,h]=w([]);g(()=>{const c=()=>{R(t,s).then(u=>{h(d=>d.length!==u.length||JSON.stringify(d)!==JSON.stringify(u)?u:d)})};c();const l=setInterval(c,r);return()=>{clearInterval(l)}},[t,s,r]),g(()=>{const c=U(o)||0;if(c>0){const l=setTimeout(()=>{h(C)},(c+2)*a);return()=>{clearTimeout(l)}}},[o]);const f=({uuid:c})=>{window.localStorage.setItem(n+c,String(Math.round(Date.now()/a))),setTimeout(()=>{h(l=>{const u=l.filter(d=>d.uuid!==c);return u.length<l.length?u:l})},2e3)};return m(A,{children:o.map(c=>{const{uuid:l,styleClass:u,renderedAlert:d=c.message,dismissible:j}=c,F=O[u]||"info";return m(y,{type:F,childrenHTML:d,onClose:j?()=>f(c):void 0,lang:i},l)})})},M=e=>{const t=document.createElement("div");return e.append(t),t},q=(e,t)=>{if(typeof e=="string"){const o=S(e);if(o)return o}else if(e)return e;const s=S("."+t+"__alerts");if(s)return M(s);const i=document.createElement("div");return i.className=""+t+"__alerts",b("."+t+", body").slice(-1)[0].prepend(i),M(i)},B=10*a,L=2*v,J=p("default",e=>{E();const t=e.layoutName||"Layout",s=q(e.rootElm,t);D("Alert").then(()=>{const i=Math.max(e.refreshInterval||L,B);_.render(m(P,{alertsUri:e.alertsUri,baseUrl:e.baseUrl,refreshInterval:i,lang:I()}),s)})})}}});
